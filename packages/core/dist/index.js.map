{"version":3,"sources":["../src/index.ts","../src/regexps.ts","../src/generator.ts","../src/compiler.ts","../src/context.ts","../src/utils.ts"],"sourcesContent":["import { createContext } from \"./context\"\nimport { PluginOption } from 'vite'\nimport { filterVue } from \"./utils\"\nimport type {MiniunocssParams} from './types'\n\nexport function miniunocss({ presets }: MiniunocssParams) {\n  const context = createContext(presets)\n  return {\n    name: 'miniunocss',\n    enforce: 'pre',\n    transform(code, id) {\n      if (!filterVue(id)) return\n      context.generatorCode(code)\n      return null\n    }\n  } as PluginOption\n}\n\n","export const classReg = /class=[\\\"|\\'](.+?)[\\\"|\\']/g;\n","import { Context } from \"./context\";\n\nexport class CssGenerator {\n  constructor(public _ctx: Context) {\n  }\n  convertCss() {\n    let css = ''\n    this._ctx._vunocss.forEach(vunocss => {\n      let attrStr = ''\n      Object.keys(vunocss.attrs).forEach(key => {\n        const value = vunocss.attrs[key]\n        attrStr += `${key}:${value};`\n      })\n      css += `.${vunocss.key}{${attrStr}}`\n    });\n    console.log(css);\n    this._ctx.reset()\n    return css\n  }\n}\n","import { Context } from \"./context\";\nimport { CssGenerator } from \"./generator\";\n\nexport class Compiler {\n  constructor(public _ctx: Context) {\n  }\n  patch() {\n   this.compilerToClassName()\n  }\n  compilerToClassName() {\n    this._ctx._classNameSet.forEach(className => {\n      this._ctx._rulesSting.forEach(rulesSting => {\n        const ruleSting = rulesSting[0]\n        const fnRes = rulesSting[1]()\n        if (className === ruleSting) {\n          loadCache(this._ctx, className, fnRes)\n        }\n      })\n\n      this._ctx._rulesReg.forEach(rulesReg => {\n        const reg = rulesReg[0]\n        const fn = rulesReg[1]\n        const exec = reg.exec(className)\n        if (exec) {\n          const fnRes = fn(exec)\n          loadCache(this._ctx, className, fnRes)\n        }\n      })\n    })\n    const cssGenerator = new CssGenerator(this._ctx)\n    cssGenerator.convertCss()\n  }\n}\n\nfunction loadCache(ctx: Context, className: string, fnRes: any) {\n  let cacheVunocss = ctx._cache.get(className)\n  if (cacheVunocss) {\n  } else {\n    cacheVunocss = {\n      key: className,\n      attrs: fnRes\n    }\n    ctx._cache.set(className, cacheVunocss)\n\n  }\n  ctx._vunocss.push(cacheVunocss)\n}\n","import type { Presets, PresetsRulesReg, PresetsRulesString, Vunocss } from \"./types\";\nimport { classReg } from \"./regexps\";\nimport { CssGenerator } from './generator'\nimport { Compiler } from \"./compiler\";\n\nexport function createContext(presets: Presets[]) {\n  return new Context(presets)\n}\nexport class Context {\n  _presets: Presets[]\n  _rulesSting: PresetsRulesString[] = []\n  _rulesReg: PresetsRulesReg[] = []\n  _classNameSet: Set<string> = new Set<string>()\n  _pseudoClassSet: Set<string> = new Set<string>()\n  _vunocss: Vunocss[] = []\n  _cache = new Map<string, Vunocss>()\n  constructor(presets: Presets[]) {\n    this._presets = presets\n    // 初始化正则\n    this.initRules(this._presets)\n  }\n  initRules(presets: Presets[]) {\n    presets.forEach(preset => {\n      preset.rules.forEach(rule => {\n        const flag = rule[0]\n        if (typeof flag === 'string') {\n          this._rulesSting.push(rule as PresetsRulesString)\n        } else if (flag.test) {\n          this._rulesReg.push(rule as PresetsRulesReg)\n        }\n      })\n    })\n  }\n  generatorCode(code: string) {\n\n    while (true) {\n      const exec = classReg.exec(code);\n      if (exec) {\n        const res = exec[1];\n        // todo 伪类\n        res.split(\" \").forEach((it) => {\n          if (/\\:/.test(it)) {\n            this._pseudoClassSet.add(it)\n          } else {\n            this._classNameSet.add(it);\n          }\n        });\n      } else {\n        break;\n      }\n    }\n    const compiler = new Compiler(this)\n    compiler.patch()\n  }\n  reset() {\n    this._vunocss.length = 0\n    this._classNameSet.clear()\n    this._pseudoClassSet.clear()\n  }\n}\n\n\n","\nconst vueFile = /.vue$/\nexport function filterVue(id: string) {\n  return vueFile.test(id)\n}"],"mappings":"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","names":[]}